- package: vtsnn
  version: 0.0.0
  data-files:
    - network_config/*.yml

- model: vtsnn
  description: VT-SNN models
  sourcecode:
    select:
      - exclude: slayerPytorch
  operations:
    prepare-data:
      description: Preprocess data for training
      main: preprocess
      flags:
        save_dir: /home/tasbolat/some_python_examples/data_VT_SNN_new/
        tactile_path: /datasets/eventdata/batch2/aces_recordings/
        video_path: /datasets/eventdata/batch2/prophesee_recordings/
        trajectory_path: /datasets/eventdata/batch2/traj_start_ends/
        threshold: 1
        selection: grasp_lift_hold
        modes: vitac # vi, tac, vitac
        bin_duration: 0.02
        n_sample_per_object: 20
        remove_outlier: 0
    downsample-vision:
      description: Downsample vision data with sum pool and save as one file
      main: downsample_images
      flags:
        path: /home/tasbolat/some_python_examples/data_VT_SNN_new/
        theta: 10
        tsample: 325
        tauRho: 1
        count: 400 # total number of samples
    tact-snn:
      description: Train tactile model using SNN
      main: train_tac_snn
      output-scalars: no
      objective:
        maximize: acc/test
      flags-import:
        - batch_size
        - epochs
        - tsample
        - tsr_stop
        - sc_true
        - sc_false
        - lr
        - theta
        - tauRho
        - sample_file
        - hidden_size
        - output_size
        - checkpoint_dir
        - loss_type
      flags:
        batch_size: 8
        epochs: 500
        lr: 0.001
        data_dir: /home/tasbolat/some_python_examples/data_VT_SNN_new/
        tsample: 325
        tauRho: 1
        tsr_stop: 325
        sc_true: 150
        sc_false: 5
        theta: 10
        sample_file: 1
        hidden_size: 32
        checkpoint_dir: . 
        loss_type: 0
      compare:
        - =batch_size
        - =epochs
        - =tsample
        - =tsr_stop
        - =sc_true
        - =sc_false
        - =lr
        - =theta
        - =tauRho
        - =sample_file
        - =hidden_size
        - =loss_type
        - loss/train as loss_train
        - max acc/train as max_acc_train
        - loss/test as loss_test
        - max acc/test as max_acc_test
        - acc/test as acc_test
        - acc/train as acc_train
    vis-snn:
      description: Train vizual model
      main: train_vis_snn
      output-scalars: no
      objective:
        maximize: acc/test
      flags-import:
        - batch_size
        - epochs
        - tsample
        - tsr_start
        - tsr_stop
        - sc_true
        - sc_false
        - hidden_size
        - lr
        - sample_file
        - output_size
        - checkpoint_dir
        - theta
        - tauRho
        - loss_type
      flags:
        batch_size: 8
        epochs: 500
        lr: 0.001
        data_dir: /home/tasbolat/some_python_examples/data_VT_SNN_new/
        tsample: 325
        tsr_start: 0
        tsr_stop: 325
        sc_true: 150
        sc_false: 5
        sample_file: 1
        output_size: 20
        theta: 10
        tauRho: 1
        hidden_size: 32
        checkpoint_dir: .
        loss_type: 0
      compare:
        - =batch_size
        - =epochs
        - =tsample
        - =tsr_stop
        - =sc_true
        - =sc_false
        - =lr
        - =sample_file
        - =hidden_size
        - =theta
        - =tauRho
        - =loss_type
        - loss/train as loss_train
        - max acc/train as max_acc_train
        - acc/train as acc_train
        - loss/test as loss_test
        - acc/test as acc_test
        - max acc/test as max_acc_test
    mm-snn:
      description: Train MM model
      main: train_mm_snn
      output-scalars: no
      objective:
        maximize: acc/test
      flags-import:
        - batch_size
        - epochs
        - tsample
        - tsr_start
        - tsr_stop
        - sc_true
        - sc_false
        - lr
        - sample_file
        - theta
        - tauRho
        - output_size
        - loss_type
      flags:
        batch_size:
          default: 8
        epochs:
          default: 500
        lr:
          default: 0.001
        data_dir:
          default: /home/tasbolat/some_python_examples/data_VT_SNN_new
        tsample:
          default: 325
        tsr_start:
          default: 0
        tsr_stop:
          default: 325
        sc_true:
          default: 150
        sc_false:
          default: 5
        sample_file:
          default: 1        
        output_size:
          default: 20
        checkpoint_dir: .
        theta: 10
        tauRho: 1
        loss_type: 0
      compare:
        - =batch_size
        - =prob
        - =epochs
        - =tsample
        - =tsr_stop
        - =sc_true
        - =sc_false
        - =lr
        - =sample_file
        - =theta
        - =tauRho
        - =loss_type
        - loss/train as loss_train
        - max acc/train as max_acc_train
        - loss/test as loss_test
        - acc/test as acc_test
        - acc/train as acc_train
        - max acc/test as max_acc_test
    tact-ann:
      description: Train tactile model using ANN (MLP-GRU)
      main: train_tac_ann
      output-scalars: no
      objective:
        maximize: acc/test
      flags-import:
        - batch_size
        - epochs
        - lr
        - sample_file
        - hidden_size
        - output_size
        - checkpoint_dir
      flags:
        batch_size: 8
        epochs: 600
        lr: 0.0001
        data_dir: /home/tasbolat/some_python_examples/data_VT_SNN_new/
        sample_file: 1
        hidden_size: 32
        checkpoint_dir: . #/home/tasbolat/some_python_examples/VT_SNN/logged_models/
      compare:
        - =batch_size
        - =epochs
        - =lr
        - =sample_file
        - =hidden_size
        - loss/train as loss_train
        - max acc/train as max_acc_train
        - loss/test as loss_test
        - max acc/test as max_acc_test
        - acc/test as acc_test
        - acc/train as acc_train
    vis-ann:
      description: Train vision model using ANN (MLP-GRU)
      main: train_vis_ann
      output-scalars: no
      objective:
        maximize: acc/test
      flags-import:
        - batch_size
        - epochs
        - lr
        - sample_file
        - hidden_size
        - output_size
        - checkpoint_dir
      flags:
        batch_size: 8
        epochs: 400
        lr: 0.0001
        data_dir: /home/tasbolat/some_python_examples/data_VT_SNN_new/
        sample_file: 1
        hidden_size: 32
        checkpoint_dir: .
      compare:
        - =batch_size
        - =epochs
        - =lr
        - =sample_file
        - =hidden_size
        - loss/train as loss_train
        - max acc/train as max_acc_train
        - loss/test as loss_test
        - max acc/test as max_acc_test
        - acc/test as acc_test
        - acc/train as acc_train
    mm-ann:
      description: Train multimodal model using ANN (MLP-GRU)
      main: train_mm_ann
      output-scalars: no
      objective:
        maximize: acc/test
      flags-import:
        - batch_size
        - epochs
        - lr
        - sample_file
        - hidden_size
        - output_size
        - checkpoint_dir
      flags:
        batch_size: 8
        epochs: 400
        lr: 0.0001
        data_dir: /home/tasbolat/some_python_examples/data_VT_SNN_new/
        sample_file: 1
        hidden_size: 32
        output_size: 20
        checkpoint_dir: . 
      compare:
        - =batch_size
        - =epochs
        - =lr
        - =sample_file
        - =hidden_size
        - =output_size
        - loss/train as loss_train
        - max acc/train as max_acc_train
        - loss/test as loss_test
        - max acc/test as max_acc_test
        - acc/test as acc_test
        - acc/train as acc_train
    tact-cnn3d:
      description: Train tactile model usin CNN3D
      main: cnn_files/train_tac_cnn
      output-scalars: no
      objective:
        maximize: acc/test
      flags-import:
        - batch_size
        - epochs
        - tsample
        - lr
        - sample_file
        - output_size
        - checkpoint_dir
      flags:
        batch_size: 8
        epochs: 200
        lr: 0.00001
        data_dir: /home/tasbolat/some_python_examples/data_VT_SNN_new/
        sample_file: 1
        output_size: 20
        checkpoint_dir: . #/home/tasbolat/some_python_examples/VT_SNN/logged_models/
      compare:
        - =batch_size
        - =epochs
        - =lr
        - =sample_file
        - =output_size
        - loss/train as loss_train
        - max acc/train as max_acc_train
        - loss/test as loss_test
        - max acc/test as max_acc_test
        - acc/test as acc_test
        - acc/train as acc_train
    vis-cnn3d:
      description: Train vision model using CNN3D
      main: cnn_files/train_vis_cnn
      output-scalars: no
      objective:
        maximize: acc/test
      flags-import:
        - batch_size
        - epochs
        - lr
        - sample_file
        - hidden_size
        - output_size
        - checkpoint_dir
      flags:
        batch_size: 8
        epochs: 2000
        lr: 0.00001
        data_dir: /home/tasbolat/some_python_examples/data_VT_SNN_new/
        sample_file: 1
        output_size: 20
        checkpoint_dir: . 
      compare:
        - =batch_size
        - =epochs
        - =lr
        - =sample_file
        - =hidden_size
        - loss/train as loss_train
        - max acc/train as max_acc_train
        - loss/test as loss_test
        - max acc/test as max_acc_test
        - acc/test as acc_test
        - acc/train as acc_train
    mm-cnn3d:
      description: Train multimodal model using CNN3D
      main: cnn_files/train_mm_cnn
      output-scalars: no
      objective:
        maximize: acc/test
      flags-import:
        - batch_size
        - epochs
        - lr
        - sample_file
        - output_size
        - checkpoint_dir
      flags:
        batch_size: 8
        epochs: 600
        lr: 0.00001
        data_dir: /home/tasbolat/some_python_examples/data_VT_SNN_new/
        sample_file: 1
        output_size: 20
        checkpoint_dir: .
      compare:
        - =batch_size
        - =epochs
        - =lr
        - =sample_file
        - =output_size
        - loss/train as loss_train
        - max acc/train as max_acc_train
        - loss/test as loss_test
        - max acc/test as max_acc_test
        - acc/test as acc_test
        - acc/train as acc_train
    benchmark:
      description: Run benchmarks on trained model
      main: benchmark
      requires:
        - operation: loihi-tact
      flags:
        data_dir: /home/tasbolat/some_python_examples/data_VT_SNN/slip_data/bin_150/
        bsize: 1
        log: gpu.json
        output_size: 2
        hidden_size: 32
        sample_file: 1
        network_config: /home/jethro/slip.yml
        num_inf: 100000
        gpu: 0
    loihi-tact:
      description: Train tactile model
      main: train_tac_loihi_snn
      output-scalars: no
      objective:
        maximize: acc/test
      flags:
        batch_size: 8
        epochs: 500
        lr: 0.01
        data_dir: /home/tasbolat/some_python_examples/data_VT_SNN/slip_data/bin_150/
        network: /home/jethro/slip.yml
        sample_file: 1
        hidden_size: 32
        output_size: 2
        checkpoint_dir: .
      compare:
        - =batch_size
        - =prob
        - =epochs
        - =tsample
        - =tsr_stop
        - =sc_true
        - =sc_false
        - =lr
        - =sample_file
        - =hidden_size
        - spike_loss/train as spike_loss_train
        - l1_loss/train as l1_loss_train
        - l2_loss/train as l2_loss_train
        - loss/train as loss_train
        - max acc/train as max_acc_train
        - l1_loss/test as l1_loss_test
        - l2_loss/test as l2_loss_test
        - loss/test as loss_test
        - max acc/test as max_acc_test
    test-loihi-tact:
      description: Test tactile Loihi model
      main: test_loihi_snn
      output-scalars: no
      requires:
        - operation: loihi-tact
      flags-import:
        - batch_size
        - network
        - sample_file
        - hidden_size
        - output_size
      flags:
        batch_size: 8
        epochs: 500
        data_dir: /home/tasbolat/some_python_examples/data_VT_SNN/slip_data/bin_150/
        network: /home/jethro/slip.yml
        sample_file: 1
        hidden_size: 32
    quantize:
      description: Quantize model parameters
      main: quantize_params
      output-scalars: no
      flags-import:
        - network
        - hidden_size
        - output_size
        - saved_weights
      flags:
        network: /home/jethro/slip.yml
        hidden_size: 128
        saved_weights: /home/jethro/.pyenv/versions/miniconda3-4.3.30/.guild/runs/531192ed28934262a4db385ffe9d6d18/weights-1000-6.810.pt
